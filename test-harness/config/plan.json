{
  "project": "ralph-test-tasktracker",
  "branch": "main",
  "max_iterations": 30,
  "validation_strategy": "strict",
  "tasks": [
    {
      "id": "TASK-001",
      "title": "Bootstrap Express server with health endpoint",
      "description": "Set up the Express server in src/server.js with proper middleware configuration and a health check endpoint. The server should:\n1. Use express.json() middleware for parsing JSON request bodies\n2. Serve static files from the public/ directory\n3. Implement GET /health that returns { status: 'ok', timestamp: <ISO string> }\n4. Export the app and a start() function that begins listening on PORT\n5. The start() function should only listen if this file is run directly (not when required by tests)\n\nWrite tests in tests/server.test.js that verify:\n- GET /health returns 200 with correct JSON shape\n- Unknown routes return 404\n- The app can be required without starting the server",
      "status": "pending",
      "order": 1,
      "skills": ["express-api"],
      "needs_docs": true,
      "libraries": ["express"],
      "acceptance_criteria": [
        "GET /health returns 200 with { status: 'ok', timestamp: string }",
        "Static files served from public/ directory",
        "Unknown routes return 404 JSON response",
        "Server does not auto-listen when required as module",
        "All tests pass (npm test)",
        "No lint errors (npm run lint)"
      ],
      "depends_on": [],
      "retry_count": 0,
      "max_retries": 2
    },
    {
      "id": "TASK-002",
      "title": "Create task data model with in-memory store",
      "description": "Create src/models/task.js with an in-memory task store. The module should provide:\n\n1. A Task schema: { id (auto-generated integer), title (string), description (string, optional), status (enum: 'pending'|'in_progress'|'done'), createdAt (ISO string), updatedAt (ISO string) }\n2. Functions: createTask(data), getTaskById(id), getAllTasks(), updateTask(id, data), deleteTask(id)\n3. Auto-increment integer IDs starting from 1\n4. createTask should set createdAt/updatedAt to current time, default status to 'pending'\n5. updateTask should update the updatedAt timestamp\n6. deleteTask returns true if deleted, false if not found\n7. getAllTasks returns an array (empty if no tasks)\n\nWrite comprehensive tests in tests/models/task.test.js covering all CRUD operations, edge cases (not found, empty store), and data integrity.",
      "status": "pending",
      "order": 2,
      "skills": [],
      "needs_docs": false,
      "libraries": [],
      "acceptance_criteria": [
        "createTask returns a task with auto-generated ID and timestamps",
        "getTaskById returns null for non-existent IDs",
        "getAllTasks returns empty array when store is empty",
        "updateTask modifies only specified fields and updates updatedAt",
        "deleteTask returns boolean indicating success",
        "Status defaults to 'pending' on creation",
        "All tests pass (npm test)",
        "No lint errors (npm run lint)"
      ],
      "depends_on": ["TASK-001"],
      "retry_count": 0,
      "max_retries": 2
    },
    {
      "id": "TASK-003",
      "title": "Implement REST API endpoints for tasks",
      "description": "Create src/routes/tasks.js as an Express Router with full CRUD endpoints for tasks:\n\n1. GET /api/tasks — List all tasks, returns { tasks: [...], count: number }\n2. GET /api/tasks/:id — Get single task by ID, returns task object or 404\n3. POST /api/tasks — Create task from request body, returns 201 with created task\n4. PUT /api/tasks/:id — Update task, returns updated task or 404\n5. DELETE /api/tasks/:id — Delete task, returns 204 on success or 404\n\nMount the router in src/server.js at /api/tasks.\n\nWrite integration tests in tests/routes/tasks.test.js using supertest:\n- Test all 5 endpoints with happy path\n- Test 404 responses for non-existent task IDs\n- Test that POST returns 201 status code\n- Test that DELETE returns 204 status code\n- Ensure the task list starts empty in each test (reset store between tests)",
      "status": "pending",
      "order": 3,
      "skills": ["express-api"],
      "needs_docs": true,
      "libraries": ["express"],
      "acceptance_criteria": [
        "GET /api/tasks returns { tasks: [], count: 0 } when empty",
        "POST /api/tasks with valid body returns 201",
        "GET /api/tasks/:id returns the created task",
        "PUT /api/tasks/:id updates and returns the modified task",
        "DELETE /api/tasks/:id returns 204",
        "Non-existent IDs return 404 with error message",
        "Store resets properly between test runs",
        "All tests pass (npm test)",
        "No lint errors (npm run lint)"
      ],
      "depends_on": ["TASK-002"],
      "retry_count": 0,
      "max_retries": 3
    },
    {
      "id": "TASK-004",
      "title": "Add request input validation middleware",
      "description": "Create src/middleware/validate.js with validation middleware for task endpoints:\n\n1. Validate POST /api/tasks body:\n   - title: required, string, 1-100 characters, trimmed\n   - description: optional, string, max 500 characters\n   - status: optional, must be one of 'pending', 'in_progress', 'done'\n2. Validate PUT /api/tasks/:id body:\n   - Same rules as POST but all fields optional (partial update)\n   - At least one field must be provided\n3. Validate route params:\n   - :id must be a positive integer\n4. Return 400 with { error: string, details: [...] } on validation failure\n5. Sanitize string inputs: trim whitespace, strip HTML tags\n\nApply the middleware to the task routes in src/routes/tasks.js.\n\nWrite tests in tests/middleware/validate.test.js covering:\n- Empty title rejected\n- Title over 100 chars rejected\n- Invalid status value rejected\n- Valid partial update accepted\n- HTML tags stripped from title and description\n- Non-integer ID rejected\n- Empty PUT body rejected",
      "status": "pending",
      "order": 4,
      "skills": [],
      "needs_docs": false,
      "libraries": [],
      "acceptance_criteria": [
        "POST with empty title returns 400",
        "POST with title > 100 chars returns 400",
        "POST with invalid status returns 400 listing valid values",
        "PUT with no fields returns 400",
        "GET/PUT/DELETE with non-integer :id returns 400",
        "HTML tags stripped from title (e.g., '<script>alert(1)</script>' becomes 'alert(1)')",
        "Description over 500 chars returns 400",
        "Valid requests pass through middleware unchanged",
        "All tests pass (npm test)",
        "No lint errors (npm run lint)"
      ],
      "depends_on": ["TASK-003"],
      "retry_count": 0,
      "max_retries": 3
    },
    {
      "id": "TASK-005",
      "title": "Add task filtering and pagination",
      "description": "Extend GET /api/tasks to support filtering and pagination via query parameters:\n\n1. Filtering:\n   - ?status=pending — filter by status\n   - ?search=keyword — case-insensitive search in title and description\n2. Pagination:\n   - ?page=1&limit=10 — page-based pagination (defaults: page=1, limit=10)\n   - Response includes: { tasks: [...], count: number, page: number, limit: number, totalPages: number }\n3. Combined: filters apply before pagination\n4. Invalid page/limit values default to 1/10 respectively\n\nWrite tests in tests/routes/filtering.test.js:\n- Filter by each status value\n- Search finds matches in both title and description\n- Pagination returns correct slice and metadata\n- Combined filter + pagination works correctly\n- Edge cases: page beyond total, limit=0, negative page",
      "status": "pending",
      "order": 5,
      "skills": [],
      "needs_docs": false,
      "libraries": [],
      "acceptance_criteria": [
        "?status=pending returns only pending tasks",
        "?search=keyword is case-insensitive across title and description",
        "Default pagination is page=1, limit=10",
        "Response includes totalPages calculated correctly",
        "Page beyond total returns empty tasks array with correct metadata",
        "Invalid page/limit values use defaults without error",
        "All tests pass (npm test)",
        "No lint errors (npm run lint)"
      ],
      "depends_on": ["TASK-003"],
      "retry_count": 0,
      "max_retries": 2
    },
    {
      "id": "TASK-006",
      "title": "Create frontend HTML structure",
      "description": "Redesign public/index.html with a complete semantic HTML structure for the task tracker UI:\n\n1. Header: App title and a task count summary area\n2. Task creation form: title input, description textarea, submit button\n3. Filter controls: status filter dropdown (All/Pending/In Progress/Done), search input\n4. Task list container: an empty <ul> or <div> that will be populated by JavaScript\n5. Individual task template concept: each task should display title, description, status badge, created date, action buttons (edit, delete)\n6. Footer: simple footer with app info\n\nUse semantic HTML5 elements (header, main, section, form, etc.).\nAdd appropriate id and class attributes that the JavaScript will target.\nDo NOT add inline styles — CSS will be added in a later task.\n\nWrite tests in tests/frontend/html.test.js that verify:\n- The HTML file exists and is valid (parseable)\n- Key elements exist: form, task list container, filter controls\n- Form has required input fields with correct attributes",
      "status": "pending",
      "order": 6,
      "skills": [],
      "needs_docs": false,
      "libraries": [],
      "acceptance_criteria": [
        "HTML uses semantic elements (header, main, section, form)",
        "Task creation form has title input (required) and description textarea",
        "Status filter dropdown with All/Pending/In Progress/Done options",
        "Search input field present",
        "Task list container with identifiable ID for JS targeting",
        "All elements have appropriate id/class attributes",
        "Add Playwright test in tests/e2e/structure.spec.js verifying form, task list container, and filter controls render in the browser",
        "All tests pass (npm test)",
        "No lint errors (npm run lint)",
        "All Playwright tests pass (npx playwright test)"
      ],
      "depends_on": ["TASK-001"],
      "retry_count": 0,
      "max_retries": 2
    },
    {
      "id": "TASK-007",
      "title": "Frontend JavaScript API client and rendering",
      "description": "Create public/app.js with a frontend JavaScript module that:\n\n1. API Client functions:\n   - fetchTasks(filters) — GET /api/tasks with query params\n   - createTask(data) — POST /api/tasks\n   - updateTask(id, data) — PUT /api/tasks/:id\n   - deleteTask(id) — DELETE /api/tasks/:id\n2. DOM Rendering:\n   - renderTaskList(tasks) — populate the task list container with task elements\n   - renderTask(task) — create DOM element for a single task with status badge, action buttons\n   - updateTaskCount(count) — update the task count display\n3. Event Handlers:\n   - Form submit → createTask → re-render list\n   - Delete button → deleteTask → re-render list\n   - Status filter change → fetchTasks with filter → re-render\n   - Search input (debounced) → fetchTasks with search → re-render\n4. Initialize on DOMContentLoaded: fetch and render initial task list\n\nWrite tests in tests/frontend/app.test.js:\n- Test API client functions construct correct URLs\n- Test renderTask produces correct HTML structure\n- Test that event handlers are wired correctly\nNote: Use jest with manual mocks for fetch (no jsdom needed — test the logic, not the DOM)",
      "status": "pending",
      "order": 7,
      "skills": [],
      "needs_docs": false,
      "libraries": [],
      "acceptance_criteria": [
        "API client functions make correct HTTP requests to /api/tasks endpoints",
        "renderTaskList populates the task list container",
        "Form submission calls createTask and refreshes the list",
        "Delete button calls deleteTask for the correct task ID",
        "Status filter change triggers filtered fetch",
        "Search input is debounced (at least 300ms)",
        "Add Playwright test in tests/e2e/tasks.spec.js verifying creating and listing tasks via the UI",
        "All tests pass (npm test)",
        "No lint errors (npm run lint)",
        "All Playwright tests pass (npx playwright test)"
      ],
      "depends_on": ["TASK-003", "TASK-006"],
      "retry_count": 0,
      "max_retries": 2
    },
    {
      "id": "TASK-008",
      "title": "CSS styling and responsive layout",
      "description": "Create public/style.css with a clean, modern design for the task tracker:\n\n1. Layout: CSS Grid or Flexbox-based responsive layout\n   - Single column on mobile (< 768px)\n   - Comfortable reading width on desktop (max-width: 800px, centered)\n2. Components:\n   - Form styling: clean inputs with focus states, prominent submit button\n   - Task cards: bordered cards with padding, subtle shadow\n   - Status badges: colored pills (pending=yellow, in_progress=blue, done=green)\n   - Action buttons: icon-style with hover effects\n   - Filter bar: horizontal layout with aligned controls\n3. CSS custom properties for theming:\n   - --color-primary, --color-bg, --color-text, --color-border\n   - --color-status-pending, --color-status-progress, --color-status-done\n4. Dark mode: @media (prefers-color-scheme: dark) overrides\n5. Transitions: subtle transitions on hover/focus states (0.2s)\n\nWrite tests in tests/frontend/styles.test.js:\n- CSS file exists and is non-empty\n- Contains expected class names (.task-card, .status-badge, etc.)\n- Contains CSS custom properties\n- Contains media query for responsive/dark mode",
      "status": "pending",
      "order": 8,
      "skills": [],
      "needs_docs": false,
      "libraries": [],
      "acceptance_criteria": [
        "Responsive layout works at mobile and desktop widths",
        "Status badges have distinct colors for each status",
        "CSS custom properties defined for theming",
        "Dark mode support via prefers-color-scheme media query",
        "Form inputs have visible focus states",
        "Task cards have border and subtle shadow",
        "All existing Playwright tests continue to pass",
        "All tests pass (npm test)",
        "No lint errors (npm run lint)",
        "All Playwright tests pass (npx playwright test)"
      ],
      "depends_on": ["TASK-006"],
      "retry_count": 0,
      "max_retries": 2
    },
    {
      "id": "TASK-009",
      "title": "Error handling system",
      "description": "Implement comprehensive error handling across both frontend and backend:\n\nBackend (src/middleware/errorHandler.js):\n1. Global Express error handler middleware (4-arg function)\n2. Catch async route errors (wrap route handlers or use express-async-errors pattern)\n3. Consistent error response format: { error: string, code: string, details?: any }\n4. Log errors to console with timestamp\n5. Handle specific error types: ValidationError (400), NotFoundError (404), default (500)\n6. In production, hide internal error details from 500 responses\n\nFrontend (update public/app.js):\n1. Add error display area in the UI\n2. showError(message) — display error message to user with dismiss button\n3. Wrap all API calls in try/catch, show user-friendly errors\n4. Handle network errors (server unreachable) gracefully\n5. Auto-dismiss errors after 5 seconds\n\nWrite tests in tests/middleware/errorHandler.test.js:\n- 400 errors include validation details\n- 404 errors return correct format\n- 500 errors hide internal details in production mode\n- Async errors are caught and forwarded to error handler\n\nAlso add error scenario tests in tests/routes/tasks.test.js if not already covered.",
      "status": "pending",
      "order": 9,
      "skills": [],
      "needs_docs": false,
      "libraries": [],
      "acceptance_criteria": [
        "Global error handler catches unhandled route errors",
        "Error response format is consistent: { error, code, details }",
        "404 errors return 'NOT_FOUND' code",
        "400 errors return 'VALIDATION_ERROR' code with details",
        "500 errors hide stack traces in production",
        "Frontend displays errors in a dismissable notification area",
        "Network errors show user-friendly message",
        "Add Playwright test in tests/e2e/errors.spec.js verifying error messages display and auto-dismiss in the browser",
        "All tests pass (npm test)",
        "No lint errors (npm run lint)",
        "All Playwright tests pass (npx playwright test)"
      ],
      "depends_on": ["TASK-004", "TASK-007"],
      "retry_count": 0,
      "max_retries": 2
    },
    {
      "id": "TASK-010",
      "title": "Sorting and bulk operations",
      "description": "Add sorting capabilities and bulk operations to the task tracker:\n\nBackend:\n1. Extend GET /api/tasks with sort query parameter:\n   - ?sort=createdAt (default), ?sort=title, ?sort=status, ?sort=updatedAt\n   - ?order=asc|desc (default: desc for dates, asc for title)\n2. Add bulk operations endpoint:\n   - POST /api/tasks/bulk — { action: 'delete'|'updateStatus', ids: [number], status?: string }\n   - Returns { affected: number, results: [...] }\n   - Validate all IDs exist before executing (atomic: all or nothing)\n3. Update src/models/task.js with any needed helper functions\n\nFrontend:\n1. Add sort controls to the task list header (clickable column headers or dropdown)\n2. Add checkbox to each task card for bulk selection\n3. Add bulk action bar that appears when tasks are selected\n4. Bulk delete and bulk status change buttons\n\nWrite tests in tests/routes/bulk.test.js:\n- Sort by each field in both directions\n- Bulk delete removes all specified tasks\n- Bulk status update changes all specified tasks\n- Bulk operation with non-existent ID returns error\n- Empty IDs array returns 400",
      "status": "pending",
      "order": 10,
      "skills": [],
      "needs_docs": false,
      "libraries": [],
      "acceptance_criteria": [
        "Sort by createdAt, title, status, updatedAt all work correctly",
        "Default sort order is desc for dates, asc for title",
        "Bulk delete removes multiple tasks atomically",
        "Bulk status update changes all specified tasks",
        "Non-existent ID in bulk operation returns 400 error",
        "Frontend displays sort controls and checkboxes",
        "Bulk action bar appears/disappears based on selection",
        "All tests pass (npm test)",
        "No lint errors (npm run lint)"
      ],
      "depends_on": ["TASK-005", "TASK-007"],
      "retry_count": 0,
      "max_retries": 3
    },
    {
      "id": "TASK-011",
      "title": "Task statistics endpoint and dashboard widget",
      "description": "Add a statistics API endpoint and frontend dashboard widget:\n\nBackend (add to src/routes/tasks.js or create src/routes/stats.js):\n1. GET /api/tasks/stats returns:\n   - total: total task count\n   - byStatus: { pending: N, in_progress: N, done: N }\n   - completionRate: percentage of done tasks (0-100, rounded to 1 decimal)\n   - recentActivity: number of tasks updated in last 24 hours\n   - averageCompletionTime: average time from creation to 'done' status (null if no completed tasks)\n\nFrontend:\n1. Add a statistics dashboard section at the top of the page\n2. Display total count, status breakdown with visual bars or badges\n3. Show completion rate as a progress bar or percentage\n4. Auto-refresh stats when tasks are modified\n\nWrite tests in tests/routes/stats.test.js:\n- Stats with empty store return zeros\n- Stats reflect correct counts after creating tasks\n- Completion rate calculates correctly\n- recentActivity counts correctly based on updatedAt",
      "status": "pending",
      "order": 11,
      "skills": [],
      "needs_docs": false,
      "libraries": [],
      "acceptance_criteria": [
        "GET /api/tasks/stats returns all required fields",
        "byStatus counts are accurate",
        "completionRate is 0 when no tasks exist",
        "completionRate is correct percentage with mix of statuses",
        "recentActivity reflects tasks updated in last 24h",
        "Frontend displays stats dashboard section",
        "Stats update when tasks are created/modified/deleted",
        "All tests pass (npm test)",
        "No lint errors (npm run lint)"
      ],
      "depends_on": ["TASK-010"],
      "retry_count": 0,
      "max_retries": 2
    },
    {
      "id": "TASK-012",
      "title": "Refactor data layer to repository pattern",
      "description": "Refactor the task data model from direct in-memory operations to a repository pattern for better separation of concerns:\n\n1. Create src/repositories/taskRepository.js:\n   - Define a TaskRepository class with methods: create, findById, findAll, update, delete, count, findByFilter, bulkDelete, bulkUpdate\n   - The class encapsulates all data access logic\n   - Constructor accepts a store (defaults to in-memory)\n2. Create src/repositories/inMemoryStore.js:\n   - Extract the in-memory storage implementation\n   - Implements a Store interface: get, set, delete, getAll, clear\n3. Update src/models/task.js to use TaskRepository\n   - Keep the existing function API for backward compatibility\n   - Internally delegate to TaskRepository instance\n4. Update routes to work with the new structure\n\nCRITICAL: All existing tests MUST continue to pass without modification. This is a pure refactoring — no behavior changes. Add new tests in tests/repositories/taskRepository.test.js for the repository class directly.",
      "status": "pending",
      "order": 12,
      "skills": [],
      "needs_docs": false,
      "libraries": [],
      "acceptance_criteria": [
        "TaskRepository class exists with all CRUD methods",
        "InMemoryStore class encapsulates storage logic",
        "All existing tests pass WITHOUT modification",
        "New repository tests cover create, read, update, delete, filter, bulk operations",
        "src/models/task.js delegates to TaskRepository internally",
        "Routes continue to work identically",
        "No lint errors (npm run lint)"
      ],
      "depends_on": ["TASK-011"],
      "retry_count": 0,
      "max_retries": 3
    },
    {
      "id": "TASK-013",
      "title": "Add due dates and overdue detection",
      "description": "Add due date functionality to tasks with overdue detection:\n\nBackend:\n1. Add 'dueDate' field to task model (optional, ISO 8601 date string)\n2. Add validation: dueDate must be a valid date, not in the past on creation\n3. Add overdue detection:\n   - Task is overdue if dueDate < now AND status !== 'done'\n   - GET /api/tasks should include 'isOverdue' boolean on each task\n   - GET /api/tasks?overdue=true — filter to overdue tasks only\n4. Add GET /api/tasks/stats 'overdue' count to stats response\n5. Add sort by dueDate option\n\nFrontend:\n1. Add date picker input to the task creation form\n2. Display due date on task cards\n3. Visual indicator for overdue tasks (red border or icon)\n4. Filter option for overdue tasks\n\nWrite tests in tests/routes/duedate.test.js:\n- Task creation with valid due date\n- Task creation with past date rejected\n- Overdue detection when date passes\n- Filter by overdue=true\n- Stats include overdue count\n- Sort by dueDate works\n\nNote: Use native Date for date handling — do NOT add date-fns or other date libraries.",
      "status": "pending",
      "order": 13,
      "skills": [],
      "needs_docs": false,
      "libraries": [],
      "acceptance_criteria": [
        "Tasks accept optional dueDate field (ISO 8601)",
        "Past dates rejected on task creation with 400 error",
        "isOverdue boolean present on task responses",
        "?overdue=true filter returns only overdue tasks",
        "Stats include overdue count",
        "Sort by dueDate works in both directions",
        "Frontend displays due date and overdue indicator",
        "All tests pass (npm test)",
        "No lint errors (npm run lint)"
      ],
      "depends_on": ["TASK-012"],
      "retry_count": 0,
      "max_retries": 2
    },
    {
      "id": "TASK-014",
      "title": "Full-text search and keyboard shortcuts",
      "description": "Add enhanced search and keyboard navigation:\n\nBackend:\n1. Enhance the search query parameter to search across title, description, and status\n2. Add search result highlighting: return matches with surrounding context\n3. Add GET /api/tasks/search?q=term endpoint that returns ranked results (title matches weighted higher)\n\nFrontend:\n1. Enhance search input with live results as-you-type (debounced 300ms)\n2. Add keyboard shortcuts:\n   - 'n' — focus the new task form\n   - '/' — focus the search input\n   - 'Escape' — clear search / close modals\n   - Arrow keys — navigate task list\n   - 'Enter' on task — toggle task status\n3. Add keyboard shortcut help tooltip (? key)\n4. Ensure all interactive elements are keyboard-accessible\n\nWrite tests in tests/routes/search.test.js:\n- Search finds matches in title, description, and status\n- Title matches rank higher than description matches\n- Empty search returns all tasks\n- Search is case-insensitive\n\nWrite tests in tests/frontend/keyboard.test.js:\n- Keyboard shortcut handler responds to correct keys\n- Shortcuts only fire when not in an input field",
      "status": "pending",
      "order": 14,
      "skills": [],
      "needs_docs": false,
      "libraries": [],
      "acceptance_criteria": [
        "Search endpoint returns ranked results",
        "Title matches rank higher than description matches",
        "Live search updates as user types (debounced)",
        "Keyboard shortcuts work: n, /, Escape, arrows, Enter",
        "? key shows help tooltip listing shortcuts",
        "Shortcuts disabled when focus is in an input field",
        "Add Playwright test in tests/e2e/shortcuts.spec.js verifying keyboard shortcuts work in the browser",
        "All tests pass (npm test)",
        "No lint errors (npm run lint)",
        "All Playwright tests pass (npx playwright test)"
      ],
      "depends_on": ["TASK-013"],
      "retry_count": 0,
      "max_retries": 2
    }
  ]
}
